<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:i18n="http://genshi.edgewall.org/i18n"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />
  <head>
    <title>Learning Progress Roadmap</title>
  </head>

  <body>
    <div id="ctxtnav" class="nav"></div>

    <div id="content" class="roadmap">
      <h1>Learning Progress Roadmap</h1>

      <!-- Overall Progress Summary -->
      <div class="overall-progress-section">
        <h2>Your Learning Journey</h2>
        
        <div class="progress-summary">
          <div class="stat-card">
            <h3>Total Progress</h3>
            <div class="big-number">${overall_progress.overall_completion_percentage}%</div>
            <div class="stat-detail">
              ${overall_progress.completed_paths} of ${overall_progress.total_paths} paths completed
            </div>
          </div>
          
          <div class="stat-card">
            <h3>Active Learning</h3>
            <div class="big-number">${overall_progress.active_paths}</div>
            <div class="stat-detail">paths in progress</div>
          </div>
          
          <div class="stat-card">
            <h3>Average Score</h3>
            <div class="big-number">${overall_progress.overall_avg_score}%</div>
            <div class="stat-detail">across all attempts</div>
          </div>
          
          <div class="stat-card">
            <h3>Time Invested</h3>
            <div class="big-number">${int(overall_progress.total_learning_time_minutes / 60)}h</div>
            <div class="stat-detail">${overall_progress.total_learning_time_minutes % 60}m total</div>
          </div>
        </div>

        <!-- Cohort Comparison -->
        <py:if test="cohort_data">
          <div class="cohort-comparison">
            <h3>How You Compare</h3>
            <div class="comparison-metric">
              <span class="metric-label">vs Cohort Average:</span>
              <span class="metric-value ${cohort_data.percentile_vs_cohort > 100 and 'above-average' or 'below-average'}">
                ${cohort_data.percentile_vs_cohort}%
              </span>
            </div>
          </div>
        </py:if>
      </div>

      <!-- Milestone Progress -->
      <div class="milestones-section">
        <h2>Milestone Progress</h2>
        
        <div class="milestone-filter">
          <form method="get" action="">
            <label for="milestone">Filter by milestone:</label>
            <select name="milestone" id="milestone" onchange="this.form.submit()">
              <option value="">All Milestones</option>
              <py:for each="milestone_name in sorted(milestones.keys())">
                <option value="${milestone_name}" 
                        selected="${selected_milestone == milestone_name and 'selected' or None}">
                  ${milestone_name}
                </option>
              </py:for>
            </select>
          </form>
        </div>

        <div class="milestones-grid">
          <py:for each="milestone_name, milestone_data in sorted(milestones.items())">
            <div class="milestone-card">
              <h3 class="milestone-title">
                <a href="${req.href.milestone(milestone_name)}">${milestone_name}</a>
              </h3>
              
              <py:if test="milestone_data.milestone.due">
                <div class="milestone-due">Due: ${format_date(milestone_data.milestone.due)}</div>
              </py:if>

              <div class="progress-container">
                <div class="progress-bar">
                  <div class="progress-fill completed" 
                       style="width: ${milestone_data.stats.completion_percentage}%">
                  </div>
                  <div class="progress-fill in-progress" 
                       style="width: ${(milestone_data.stats.in_progress / milestone_data.stats.total_concepts * 100) if milestone_data.stats.total_concepts > 0 else 0}%">
                  </div>
                </div>
                <div class="progress-text">
                  ${milestone_data.stats.completion_percentage}% Complete
                </div>
              </div>

              <div class="milestone-stats">
                <div class="stat">
                  <span class="stat-value">${milestone_data.stats.completed}</span>
                  <span class="stat-label">Completed</span>
                </div>
                <div class="stat">
                  <span class="stat-value">${milestone_data.stats.in_progress}</span>
                  <span class="stat-label">In Progress</span>
                </div>
                <div class="stat">
                  <span class="stat-value">${milestone_data.stats.not_started}</span>
                  <span class="stat-label">Not Started</span>
                </div>
              </div>

              <py:if test="milestone_data.stats.avg_score > 0">
                <div class="milestone-score">
                  Average Score: <strong>${milestone_data.stats.avg_score}%</strong>
                </div>
              </py:if>

              <py:if test="milestone_data.stats.estimated_completion">
                <div class="estimated-completion">
                  Est. Completion: ${format_date(milestone_data.stats.estimated_completion)}
                </div>
              </py:if>

              <div class="milestone-actions">
                <a href="${milestone_data.stats.graph_url}" class="button">
                  View Knowledge Graph
                </a>
                <a href="${req.href.query(milestone=milestone_name, type='learning_concept')}" class="button">
                  Browse Concepts
                </a>
              </div>
            </div>
          </py:for>
        </div>
      </div>

      <!-- Learning Paths -->
      <div class="learning-paths-section">
        <h2>Your Learning Paths</h2>
        
        <div class="paths-list">
          <py:for each="path in paths">
            <div class="path-item ${path.status or 'not-started'}">
              <h4>${path.path_name}</h4>
              
              <div class="path-details">
                <span class="path-status">Status: ${path.status or 'Not Started'}</span>
                <py:if test="path.score">
                  <span class="path-score">Score: ${path.score}%</span>
                </py:if>
                <py:if test="path.last_accessed">
                  <span class="path-accessed">Last accessed: ${format_datetime(path.last_accessed)}</span>
                </py:if>
              </div>
              
              <py:if test="path.metadata and path.metadata.get('ticket_id')">
                <a href="${req.href.ticket(path.metadata['ticket_id'])}" class="path-link">
                  View Learning Concept â†’
                </a>
              </py:if>
            </div>
          </py:for>
        </div>
      </div>

      <!-- Export Options -->
      <py:if test="can_export">
        <div class="export-section">
          <h3>Export Progress Report</h3>
          <div class="export-buttons">
            <a href="${req.href.learning.roadmap.export('csv')}" class="button">
              Export as CSV
            </a>
            <a href="${req.href.learning.roadmap.export('json')}" class="button">
              Export as JSON
            </a>
            <a href="${req.href.learning.roadmap.export('pdf')}" class="button">
              Export as PDF
            </a>
          </div>
        </div>
      </py:if>
    </div>

    <script type="text/javascript">
      jQuery(document).ready(function($) {
        // Add interactive features
        $('.milestone-card').hover(
          function() { $(this).addClass('hover'); },
          function() { $(this).removeClass('hover'); }
        );
        
        // Progress bar animations
        $('.progress-fill').each(function() {
          var width = $(this).css('width');
          $(this).css('width', '0').animate({width: width}, 1000);
        });
      });
    </script>
  </body>
</html>